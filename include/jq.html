<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>モーダルウィンドウの例</title>
    <link rel="stylesheet" href="styles.css" />
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  </head>

  <body>
    <button id="openModalBtn">モーダルを開く1</button>
    <p>選択結果：<span id="result"></span></p>

    <div id="modal" class="modal">
      <div class="modal-content">
        <span id="closeModalBtn" class="close">&times;</span>
        <div>
          <form>
            <label for="name">名前:</label>
            <input type="text" id="name" name="name" />
            <button type="button" onclick="search()">検索</button>
          </form>
          <div id="searchResults">
            <!-- 検索結果の表がここに表示されます -->
          </div>
        </div>
      </div>
    </div>

    <div id="modalSub" class="modal">
      <div class="modal-content">
        <span id="closeModalSubBtn" class="close">&times;</span>
        <div>
          <form>
            <input type="hidden" id="company_id" name="company_id" value="" />
            <label for="tel">TEL:</label>
            <input type="text" id="tel" name="tel" />
            <button type="button" onclick="searchSub()">検索</button>
          </form>
          <div id="searchSubResults">
            <!-- 検索結果の表がここに表示されます -->
          </div>
        </div>
      </div>
    </div>

    <script>
      $(document).ready(function () {
        var $modal = $("#modal");
        var $modalSub = $("#modalSub");

        $("#openModalBtn").on("click", function () {
          $modal.show();
        });

        $("#closeModalBtn").on("click", function () {
          $modal.hide();
        });

        $("#closeModalSubBtn").on("click", function () {
          $modalSub.hide();
        });

        $(window).on("click", function (event) {
          if ($(event.target).is($modal)) {
            $modal.hide();
          }
          if ($(event.target).is($modalSub)) {
            $modalSub.hide();
          }
        });
      });

      function search() {
        var name = $("#name").val();
        $.ajax({
          url: "result.php",
          method: "GET",
          success: function (data) {
            $("#searchResults").html(data);
          },
          error: function (error) {
            console.error("Error fetching the content:", error);
          },
        });
      }

      function selectRow(id) {
        $("#company_id").val(id);
        $("#modalSub").show();
      }

      function searchSub() {
        var tel = $("#tel").val();
        var company_id = $("#company_id").val();
        $.ajax({
          url: "result_sub.php",
          method: "GET",
          success: function (data) {
            $("#searchSubResults").html(data);
          },
          error: function (error) {
            console.error("Error fetching the content:", error);
          },
        });
      }

      function selectSubRow(id) {
        $("#modalSub").hide();
        $("#modal").hide();
        $("#result").text(id);
      }
    </script>
  </body>
</html>
